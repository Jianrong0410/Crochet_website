<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <!-- RWD éŸ¿æ‡‰å¼è¨­è¨ˆè¨­å®šï¼šè®“é é¢åœ¨æ‰‹æ©Ÿã€å¹³æ¿ç­‰è£ç½®ä¸Šèƒ½è‡ªé©æ‡‰å¯¬åº¦ -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>é‰¤ç¹”åœ–è¾¨è­˜ç³»çµ±</title>
  <style>
  html, body {
    height: 100%;
    background: transparent; /* èƒŒæ™¯äº¤ç”±å½å…ƒç´ è™•ç† */
  }

  body {
    font-family: Arial, sans-serif;
    margin: 40px;
    color: #333;
    font-size: 18px;
  }

  /* âœ… ç”¨å½å…ƒç´ é‹ªæ»¿æ•´å€‹ç•«é¢ç•¶èƒŒæ™¯å±¤ */
  body::before {
    content: "";
    position: fixed;
    inset: 0;
    z-index: -1;
    background:
      linear-gradient(rgba(255,255,255,.8), rgba(255,255,255,.8)),
      url("{{ url_for('static', filename='img/crochet-bg.jpg') }}")
      center / cover no-repeat;
  }

  /* ğŸ“± è¡Œå‹•è£ç½®ç›¸å®¹èª¿æ•´ */
  @media (max-width: 640px) {
    body { margin: 16px; font-size: 16px; }
    body::before {
      position: absolute;
      min-height: 100dvh;
      height: 100%;
      background:
        linear-gradient(rgba(255,255,255,.82), rgba(255,255,255,.82)),
        url("{{ url_for('static', filename='img/crochet-bg.jpg') }}")
        center / cover no-repeat;
    }
  }

    h1 {
      text-align: center;             /* æ¨™é¡Œç½®ä¸­ */
      margin-bottom: 30px;            /* æ¨™é¡Œåº•éƒ¨é–“è· */
      color: #444;                    /* æ¨™é¡Œæ–‡å­—é¡è‰² */
      font-size: 30px;                /* æ¨™é¡Œå­—é«”å¤§å° */
    }

	/* === ä¸Šå‚³å€æ¨£å¼ === */
    .upload-box {
      text-align: center;             /* å…§å®¹ç½®ä¸­ */
      margin-bottom: 10px;            /* åº•éƒ¨é–“è· */
      padding: 20px;                  /* å…§è· */
      border: 2px dashed #aaa;        /* è™›ç·šé‚Šæ¡† */
      border-radius: 10px;            /* åœ“è§’é‚Šæ¡† */
      background: #fff;               /* ç™½è‰²èƒŒæ™¯ */
    }
	
    .upload-box input[type=file] {
      margin: 10px 0;                 /* ä¸Šä¸‹ç•™ç™½ */
    }
	
    .upload-box button {
      margin-top: 1px;                /* èˆ‡ä¸Šæ–¹é–“è· */
      padding: 12px 20px;             /* æŒ‰éˆ•å…§è· */
      font-size: 1.1em;               /* å­—é«”ç¨å¤§ */
      border: none;                   /* ç§»é™¤é‚Šæ¡† */
      border-radius: 6px;             /* åœ“è§’æŒ‰éˆ• */
      background: #967AA1;            /* ä¸»è‰²ï¼šç´«ç°è‰² */
      color: #fff;                    /* æ–‡å­—ç™½è‰² */
      cursor: pointer;                /* æ»‘é¼ è®Šç‚ºå¯é»æ“Šæ‰‹å‹ */
    }
	
    .upload-box button:hover { background: #AAA1C8; }
    /* æ»‘é¼ ç§»å…¥æŒ‰éˆ•æ™‚çš„è®Šè‰²æ•ˆæœ */
	
    .upload-box .camera-btn {
      display: inline-block;          /* ä½¿æ‹ç…§æŒ‰éˆ•èˆ‡ä¸Šå‚³æŒ‰éˆ•ä¸¦æ’ */
      margin-left: 10px;
      vertical-align: middle;
      padding: 12px 20px;
      font-size: 1.1em;
      border: none;
      border-radius: 6px;
      background: #967AA1;
      color: #fff;
      cursor: pointer;
    }
	
    .upload-box .camera-btn:hover { background: #AAA1C8; }
    /* æ‹ç…§æŒ‰éˆ•çš„æ»‘é¼ æ‡¸åœé¡è‰²è®ŠåŒ– */

    /* === æŒ‰éˆ•åˆ—å€å¡Šï¼ˆä¸Šå‚³èˆ‡æ‹ç…§ï¼‰ === */
    .btn-row {
      display: flex;
      justify-content: center;        /* æ°´å¹³ç½®ä¸­ */
      align-items: center;            /* å‚ç›´ç½®ä¸­ */
      gap: 20px;                      /* å…©æŒ‰éˆ•é–“è· */
      margin-top: 10px;
    }

    /* === å‹¾é¸è¼¸å‡ºé¸é …å€ === */
    .checkbox-area {
      text-align: center;
      margin-top: 20px;
      font-size: 18px;
      color: #333;
    }
	
    .checkbox-area input[type=checkbox] {
      accent-color: #ff6600;          /* å‹¾é¸æ¡†ä¸»è‰²ç‚ºæ©˜è‰² */
      transform: scale(1.3);          /* æ”¾å¤§å‹¾é¸æ¡† */
      margin-right: 6px;
    }
	
    .checkbox-area label {
      margin: 0 15px;
      font-size: 16px;
      cursor: pointer;
    }

    /* === ä¸Šå‚³é€²åº¦æ¢ === */
    .progress-container {
      width: 80%;                     /* å¯¬åº¦ 80% */
      margin: 20px auto;              /* æ°´å¹³ç½®ä¸­ */
      height: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background: #eee;
      display: none;                  /* åˆå§‹éš±è— */
    }
	
    .progress-bar {
      height: 100%;
      width: 0%;
      background: #D5C6E0;            /* ç´«ç°æ¼¸å±¤è‰² */
      border-radius: 10px;
      transition: width .2s;          /* å¯¬åº¦å¹³æ»‘è®ŠåŒ– */
    }
	
    .progress-text {
      text-align: center;
      font-size: 18px;
      margin-top: 10px;
      display: none;                  /* åˆå§‹éš±è— */
    }

    /* === é ‚éƒ¨å°è¦½åˆ— === */
    .topbar {
      display: flex;
      justify-content: space-between; /* å·¦å³å…©å´åˆ†ä½ˆ */
      align-items: center;
      gap: 12px;
      width: 100%;
      flex-wrap: nowrap;
      margin-bottom: 12px;
    }
	
    .top-left {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: nowrap;
    }

    .top-right {
      text-align: right;
    }
	
    .top-right a {
      color: #967AA1;
      margin-left: 12px;
      text-decoration: none;          /* ç§»é™¤åº•ç·š */
    }

    .pill-link {
      text-decoration: none;
      color: #333;
      background: #e0e0e0;
      padding: 8px 14px;
      border-radius: 6px;
      display: inline-block;
    }
	
    /* ä½¿ç”¨èªªæ˜ / é—œæ–¼ æŒ‰éˆ•å…±ç”¨æ¨£å¼ */
    .guide-btn, .about-btn {
      padding: 10px 20px;
      border: 2px solid #6b7280;
      border-radius: 8px;
      background: #fff;
      color: #444;
      font-size: 16px;
      cursor: pointer;
      transition: .25s;
    }
	
    .guide-btn:hover, .about-btn:hover {
      background: #f3f4f6;            /* æ»‘é¼ æ‡¸åœè®Šäº®ç° */
    }
	
    /* === å°è¢å¹•ç‰ˆï¼ˆæ‰‹æ©Ÿï¼‰è¨­å®š === */
    @media (max-width:640px) {
      body { margin:16px; font-size:16px; }
      .topbar { flex-wrap:wrap; }     /* é ‚æ¬„å¯æ›è¡Œ */
      .top-right { width:100%; text-align:right; }
    }

    /* é€šç”¨å½ˆçª— */
    .modal-mask {
      display: none;                  /* åˆå§‹éš±è— */
      position: fixed;                /* å›ºå®šæ–¼ç•«é¢ */
      inset: 0;                       /* ä½”æ»¿æ•´å€‹è¦–çª— */
      background: rgba(0,0,0,.5);     /* åŠé€æ˜é»‘åº• */
      z-index: 9999;                  /* é¡¯ç¤ºåœ¨æœ€ä¸Šå±¤ */
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }
	
    .modal-card {
      background: #fff;
      border-radius: 12px;
      padding: 25px;
      width: 85%;
      max-width: 650px;
      box-shadow: 0 4px 15px rgba(0,0,0,.25);
      text-align: left;
    }

    .modal-card h2 {
      text-align: center;
      color: #333;
      margin-top: 0;
    }
	
    .modal-actions {
      text-align: center;
      margin-top: 20px;
    }

    .modal-close {
      padding: 8px 18px;
      background: #967AA1;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    /* === ç›¸æ©Ÿå…±ç”¨å€æ¨£å¼ === */
    .camera-wrap {
      display: flex;
      flex-direction: column;
    }
	
    #cameraVideo, #cameraCanvas {
      width: 100%;
      height: auto;
      background: #000;
    }

    .camera-controls {
      margin-top: 16px;
      display: flex;
      justify-content: center;
      gap: 14px;
      flex-wrap: wrap;
    }
	
    .camera-controls button {
      padding: 10px 16px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }

    .camera-controls .danger {
      background: #ef4444;  /* ç´…è‰²ï¼šé—œé–‰ç”¨ */
      color: #fff;
    }

    .camera-controls .primary {
      background: #967AA1;  /* ä¸»è‰²ï¼šæ“ä½œç”¨ */
      color: #fff;
    }

    /* === ğŸ“± æ‰‹æ©Ÿæ»¿ç‰ˆç›¸æ©Ÿç•«é¢è¨­å®š === */
    @media (max-width:899px){
      #cameraModal { background:#fff; }
	  
      #cameraModal .modal-card {
        width:100vw; height:100vh;
        max-width:none; max-height:none;
        border-radius:0; padding:0;
        box-shadow:none;
        display:flex; flex-direction:column;
      }
	  
      #cameraModal .modal-card h2 {
        font-size:26px; margin:12px 0; color:#333;
      }
	  
      #cameraModal .camera-wrap {
        flex:1; min-height:0; display:flex; flex-direction:column;
      }
	  
      .cam-frame {
        flex:1; min-height:60vh; position:relative; width:100%;
        overflow:hidden; background:#000;
      }
	  
      #cameraVideo, #cameraCanvas {
        position:absolute; inset:0; width:100%; height:100%;
        object-fit:cover;
      }
	  
      .camera-controls {
        justify-content:center; gap:20px; padding:14px 0;
        background:#fff; border-top:1px solid #ddd;
        box-shadow:0 -2px 8px rgba(0,0,0,.08);
      }
	  
      .camera-controls button {
        font-size:20px; padding:14px 28px; border-radius:14px;
      }
    }

    /* === ğŸ–¥æ¡Œæ©Ÿæ»¿ç‰ˆç›¸æ©Ÿç•«é¢è¨­å®š === */
    @media (min-width:900px){
      #cameraModal { padding:0; background:#000; }
      #cameraModal .modal-card {
        width:100vw; height:100vh;
        max-width:none; max-height:none;
        border-radius:0; padding:0;
        background:#000;
        display:flex; flex-direction:column;
        box-shadow:none;
      }
	  
      #cameraModal .modal-card h2 {
        color:#fff; font-weight:700; font-size:24px;
        text-align:center; padding:16px 0 0;
      }
	  
      #cameraModal .camera-wrap {
        position:relative; flex:1; width:100%; height:100%;
        overflow:hidden; background:#000; padding:0 0 90px;
      }
	  
      #cameraVideo, #cameraCanvas {
        position:absolute; inset:0; width:100%; height:100%;
        max-width:none; border-radius:0; object-fit:cover;
        background:#000;
      }
	  
      #cameraModal .camera-controls {
        position:absolute; left:50%; bottom:28px;
        transform:translateX(-50%);
        margin:0; padding:10px 14px;
        border-radius:999px;
        background:rgba(0,0,0,.35);
        backdrop-filter:blur(6px);
        z-index:2;
      }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="top-left">
      <a class="pill-link" href="{{ url_for('history_page') }}">ğŸ“œ æŸ¥çœ‹æˆ‘çš„çµæœ</a>
      <a id="guideBtn" class="pill-link" type="button">ğŸ“˜ ä½¿ç”¨èªªæ˜</a>
      <a id="aboutBtn" class="pill-link" type="button">â„¹ï¸é—œæ–¼æœ¬ç³»çµ±</a>
	  <a href="{{ url_for('tutorials') }}" class="pill-link">ğŸ§µ é‡æ³•æ•™å­¸</a>
    </div>
    <div class="top-right">
      <span>ä½¿ç”¨è€…ï¼š{{ username }}</span>
      <a href="{{ url_for('feed') }}">è²¼æ–‡ç‰†</a>
      <a href="{{ url_for('my_likes') }}">æˆ‘æŒ‰éçš„è®š</a>
      <a href="{{ url_for('profile') }}">å€‹äººä»‹é¢</a>
      <a href="{{ url_for('logout') }}">ç™»å‡º</a>
    </div>
  </div>

  <h1>é‰¤ç¹”åœ–è¾¨è­˜ç³»çµ±</h1>

  <div class="upload-box">
    <form id="uploadForm" action="/predict" method="post" enctype="multipart/form-data">
      <p style="font-size:20px;">è«‹ä¸Šå‚³ä¸€å¼µé‰¤ç¹”åœ–ï¼š</p>
      <input type="file" id="fileInput" name="file" accept="image/*" required>
      <input type="file" id="captureInput" accept="image/*" capture="environment" style="display:none;">
      <br>
      <div class="btn-row">
        <button type="submit">ä¸Šå‚³ä¸¦è¾¨è­˜</button>
        <button id="cameraBtn" class="camera-btn" type="button">ç›´æ¥æ‹ç…§ä¸Šå‚³</button>
      </div>
      <div class="checkbox-area">
        <label><input type="checkbox" name="output_original"> è¼¸å‡ºåŸåœ–</label>
        <label><input type="checkbox" name="output_circle"> è¼¸å‡ºåœˆåœ–çµæœ</label>
      </div>
    </form>
  </div>

  <!-- é€²åº¦æ¢ -->
  <div class="progress-container" id="progressContainer">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <div class="progress-text" id="progressText">ç³»çµ±æ­£åœ¨åŠªåŠ›å·¥ä½œä¸­ï¼Œè«‹ç¨å€™ï¼š)</div>

   <!-- ä½¿ç”¨èªªæ˜å½ˆçª— -->
  <div id="guideModal" class="modal-mask">
    <div class="modal-card">
	<h2>ğŸ“˜ é‰¤ç¹”åœ–è¾¨è­˜ç³»çµ±ä½¿ç”¨èªªæ˜</h2>
	<ol style="line-height:1.9; font-size:17px; color:#333; padding-left: 1.2em;">
	  <li><b>ä¸Šå‚³åœ–ç‰‡ï¼š</b> é»æ“Šã€Œé¸æ“‡æª”æ¡ˆã€æˆ–ã€Œç›´æ¥æ‹ç…§ä¸Šå‚³ã€ï¼Œä¸Šå‚³ä¸€å¼µæ¸…æ™°çš„é‰¤ç¹”åœ–ã€‚</li>
	  <li><b>é¸æ“‡è¼¸å‡ºï¼š</b> å¯å‹¾é¸ã€Œè¼¸å‡ºåŸåœ–ã€æˆ–ã€Œè¼¸å‡ºåœˆåœ–çµæœã€ï¼Œç³»çµ±æœƒç”¢ç”Ÿå°æ‡‰çš„è¦–è¦ºåŒ–çµæœã€‚</li>
	  <li><b>è‡ªå‹•è¾¨è­˜ï¼š</b> ç³»çµ±æœƒä»¥è¨“ç·´æ¨¡å‹åˆ†æåœ–æ¡ˆï¼Œæ¨™å‡ºå„é‡æ³•ç¬¦è™Ÿèˆ‡æ•¸é‡ã€‚</li>
	  <li><b>æŸ¥çœ‹çµæœï¼š</b> å®Œæˆå¾Œå¯å°‡çµæœå„²å­˜è‡³ã€Œæˆ‘çš„çµæœã€ï¼Œæ—¥å¾Œéš¨æ™‚å¯ä»¥éš¨æ™‚æŸ¥çœ‹ã€‚</li>
	  <li><b>æˆ‘çš„çµæœï¼š</b> åœ¨ã€ŒæŸ¥çœ‹æˆ‘çš„çµæœã€ä¸­å¯é‡æ–°å‘½åã€ä¸‹è¼‰æˆ–åˆªé™¤è¾¨è­˜ç´€éŒ„ã€‚</li>
	  <li><b>é‡æ³•æ•™å­¸ï¼š</b> é»æ“Šå¾Œå¯ä»¥çœ‹åˆ°ç›®å‰æœ‰æ”¶éŒ„çš„é‡æ³•æ•™å­¸ï¼Œæ–¹ä¾¿å­¸ç¿’ã€‚</li>
	  <li><b>è²¼æ–‡ç‰†ï¼š</b> é»æ“Šå¾Œå¯ä»¥è‡ªå·±ç™¼å¸ƒè²¼æ–‡æˆ–è§€çœ‹å…¶ä»–äººçš„è²¼æ–‡ï¼Œé‚„å¯ä»¥æŒ‰è®šã€ç•™è¨€ã€è¿½è¹¤ã€‚</li>
	  <li><b>å€‹äººä»‹é¢ï¼š</b> å¯ä»¥ç•™ä¸‹è‡ªå·±çš„ç´€éŒ„ï¼Œæˆ–ä¸€äº›å¿ƒå¾—ï¼Œæ¦®ç²ä¸€äº›å°ç²‰çµ²ã€‚</li>
	</ol>
	<p style="margin-top:10px; color:#555; font-size:16px; line-height:1.6;">
	ğŸ’¡ <b>å°æé†’ï¼š</b> æ‹æ”æ™‚ä¿æŒå…‰ç·šå……è¶³ï¼Œé¿å…é™°å½±æˆ–æ¨¡ç³Šï¼›è‹¥ç¬¦è™Ÿè¼ƒç‰¹åˆ¥æˆ–æ‰‹ç¹ªä¸æ¸…ï¼Œè¾¨è­˜ç‡å¯èƒ½ç•¥é™ã€‚
	</p>

      <div class="modal-actions">
        <button id="closeGuide" class="modal-close">é—œé–‰</button>
      </div>
    </div>
  </div>

   <!-- é—œæ–¼æœ¬ç³»çµ±å½ˆçª— -->
  <div id="aboutModal" class="modal-mask">
    <div class="modal-card">
      <h2>â„¹ï¸ é—œæ–¼æœ¬ç³»çµ±</h2>
      <p>
        ã€Œé‰¤ç¹”åœ–è¾¨è­˜ç³»çµ±ã€æ˜¯ä¸€æ¬¾å°ˆç‚ºé‰¤ç¹”æ„›å¥½è€…ã€è¨­è¨ˆå¸«èˆ‡å­¸ç¿’è€…æ‰“é€ çš„æ™ºæ…§è¼”åŠ©å·¥å…·ã€‚
        é€éæ•´åˆäººå·¥æ™ºæ…§ï¼ˆAIï¼‰å½±åƒè¾¨è­˜æŠ€è¡“èˆ‡ YOLO æ¨¡å‹ï¼Œæœ¬ç³»çµ±èƒ½è‡ªå‹•è§£æé‰¤ç¹”åœ–æ¨£ä¸­çš„å„ç¨®é‡æ³•ç¬¦è™Ÿï¼Œ
        ä¸¦å¿«é€Ÿè¨ˆç®—å‡ºå„é‡æ³•çš„æ•¸é‡ï¼Œå”åŠ©æ‚¨ç¯€çœæ‰‹å‹•åˆ†æçš„æ™‚é–“ã€‚
      </p>
      <p>
        ç„¡è«–æ‚¨æ˜¯è¦è¨˜éŒ„è‡ªå·±çš„ä½œå“ã€å­¸ç¿’ä¸åŒé‡æ³•çš„ä½¿ç”¨ï¼Œæˆ–æ˜¯å”åŠ©æ•´ç†å¤§é‡é‰¤ç¹”æ•™æï¼Œ
        æœ¬ç³»çµ±éƒ½èƒ½æˆç‚ºæ‚¨å¯é çš„å¤¥ä¼´ã€‚ç³»çµ±äº¦æä¾›ã€Œæ­·å²ç´€éŒ„ã€åŠŸèƒ½ï¼Œè®“ä½¿ç”¨è€…èƒ½éš¨æ™‚å›é¡§éå»çš„è¾¨è­˜çµæœã€‚
      </p>
      <p>
        ç›®å‰æ”¯æ´çš„é‡æ³•é¡å‹åŒ…æ‹¬ï¼šé–é‡ã€çŸ­é‡ã€ä¸­é•·é‡ã€é•·é‡ã€å¼•æ‹”é‡ã€çˆ†ç±³èŠ±é‡ã€æ£—å½¢é‡ã€ç‹—ç‰™é‡ç­‰å¤šç¨®ç¬¦è™Ÿï¼Œ
        ä¸¦æŒçºŒæ“´å……ä¸­ã€‚æ‚¨åªéœ€ä¸Šå‚³ä¸€å¼µæ¸…æ™°çš„é‰¤ç¹”åœ–ï¼Œå³å¯ç²å¾—è¾¨è­˜çµæœèˆ‡è¦–è¦ºåŒ–åœ–åƒåŠ æ–‡å­—æ•˜è¿°ã€‚
      </p>
      <div class="modal-actions">
        <button id="closeAbout" class="modal-close">é—œé–‰</button>
      </div>
    </div>
  </div>

  <!-- ğŸ“· ç›¸æ©Ÿå½ˆçª— -->
  <div id="cameraModal" class="modal-mask">
    <div class="modal-card">
      <h2>ğŸ“· ç›´æ¥æ‹ç…§ä¸Šå‚³</h2>
	  <!-- ç›¸æ©Ÿå¤–å±¤å®¹å™¨ï¼ˆRWD é…åˆ CSS åˆ‡æ›æ‰‹æ©Ÿ/æ¡Œæ©Ÿæ»¿ç‰ˆï¼‰ -->
      <div class="camera-wrap">
        <div class="cam-frame">
          <video id="cameraVideo" autoplay playsinline muted></video>
          <canvas id="cameraCanvas" style="display:none;"></canvas>
        </div>
        <div class="camera-controls">
          <button id="captureBtn" class="primary">æ‹ç…§</button>
          <button id="retakeBtn" class="primary" style="display:none;">é‡æ‹</button>
          <button id="uploadShotBtn" class="primary" style="display:none;">ä¸Šå‚³è¾¨è­˜</button>
          <button id="closeCamera" class="danger">é—œé–‰</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ä¸Šå‚³é€²åº¦æ¢æ§åˆ¶
    document.getElementById("uploadForm").addEventListener("submit", function(e) {
      e.preventDefault(); // é˜²æ­¢è¡¨å–®ç›´æ¥é€å‡º
      const form = e.target;
      const fileInput = document.getElementById("fileInput");

      if (!fileInput.files.length) {
        alert("è«‹é¸æ“‡åœ–ç‰‡ï¼");
        return;
      }

      const formData = new FormData(form);

      // é¡¯ç¤ºé€²åº¦æ¢
      const progressContainer = document.getElementById("progressContainer");
      const progressBar = document.getElementById("progressBar");
      const progressText = document.getElementById("progressText");
      progressContainer.style.display = "block";
      progressText.style.display = "block";
      progressBar.style.width = "0%";

      // æ¨¡æ“¬é€²åº¦æ¢
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 10; // æ¨¡æ“¬é€²åº¦
        if (progress > 90) progress = 90;
        progressBar.style.width = progress + "%";
      }, 200);

      // é€å‡ºè¡¨å–®è³‡æ–™åˆ°å¾Œç«¯ /predict
      fetch(form.action, {
        method: form.method,
        body: formData
      }).then(response => response.text()).then(html => {
        clearInterval(interval);
        progressBar.style.width = "100%";

        setTimeout(() => {
          document.open();
          document.write(html);
          document.close();
        }, 300); // å»¶é²è®“ç”¨æˆ¶çœ‹åˆ°100%
      }).catch(err => {
        alert("ä¸Šå‚³å¤±æ•—ï¼š" + err);
      });
    });

    // ===== ä½¿ç”¨èªªæ˜èˆ‡é—œæ–¼ =====
    const guideBtn=document.getElementById("guideBtn");
    const aboutBtn=document.getElementById("aboutBtn");
    const guideModal=document.getElementById("guideModal");
    const aboutModal=document.getElementById("aboutModal");
    document.getElementById("closeGuide").onclick=()=>guideModal.style.display="none";
    document.getElementById("closeAbout").onclick=()=>aboutModal.style.display="none";
    guideBtn.onclick=()=>guideModal.style.display="flex";
    aboutBtn.onclick=()=>aboutModal.style.display="flex";
    guideModal.onclick=(e)=>{if(e.target===guideModal)guideModal.style.display="none";};
    aboutModal.onclick=(e)=>{if(e.target===aboutModal)aboutModal.style.display="none";};

    // ===== ç›¸æ©Ÿæ§åˆ¶ =====
    const cameraBtn=document.getElementById("cameraBtn"),
          cameraModal=document.getElementById("cameraModal"),
          videoEl=document.getElementById("cameraVideo"),
          canvasEl=document.getElementById("cameraCanvas"),
          captureBtn=document.getElementById("captureBtn"),
          retakeBtn=document.getElementById("retakeBtn"),
          uploadShotBtn=document.getElementById("uploadShotBtn"),
          closeCamera=document.getElementById("closeCamera");
    let mediaStream=null,capturedBlob=null;

    function stopStream(){if(mediaStream){mediaStream.getTracks().forEach(t=>t.stop());mediaStream=null;}}

    async function startCamera(){
      try{
        mediaStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:false});
        videoEl.srcObject=mediaStream;await videoEl.play();
        videoEl.style.display="block";canvasEl.style.display="none";
        retakeBtn.style.display="none";uploadShotBtn.style.display="none";capturedBlob=null;
      }catch{alert("ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿï¼Œè«‹ç¢ºèªæ¬Šé™å·²å…è¨±");}
    }

    cameraBtn.onclick=()=>{cameraModal.style.display="flex";document.body.classList.add('modal-open');setTimeout(startCamera,100);};
    closeCamera.onclick=()=>{stopStream();cameraModal.style.display="none";document.body.classList.remove('modal-open');};
    cameraModal.onclick=(e)=>{if(e.target===cameraModal){stopStream();cameraModal.style.display="none";document.body.classList.remove('modal-open');}}

    captureBtn.onclick=()=>{
      if(!mediaStream)return;
      const w=videoEl.videoWidth||1280,h=videoEl.videoHeight||720;
      canvasEl.width=w;canvasEl.height=h;
      canvasEl.getContext("2d").drawImage(videoEl,0,0,w,h);
      canvasEl.toBlob(blob=>{capturedBlob=blob;videoEl.style.display="none";canvasEl.style.display="block";
        retakeBtn.style.display="inline-block";uploadShotBtn.style.display="inline-block";stopStream();
      },"image/jpeg",0.92);
    };

    retakeBtn.onclick=()=>startCamera();
	uploadShotBtn.onclick = async () => {
	  if (!capturedBlob) { alert("è«‹å…ˆæ‹ç…§"); return; }

	  const fd = new FormData();
	  fd.append("file", new File([capturedBlob], "camera.jpg", { type: "image/jpeg" }));

	  // æŠŠå…©å€‹å‹¾é¸ä¹Ÿä¸€ä½µé€çµ¦å¾Œç«¯
	  const chkOrig  = document.querySelector('input[name="output_original"]');
	  const chkCircle = document.querySelector('input[name="output_circle"]');
	  if (chkOrig && chkOrig.checked)   fd.append('output_original', '1');
	  if (chkCircle && chkCircle.checked) fd.append('output_circle',  '1');

	  // é€åˆ°èˆ‡ä¸€èˆ¬ä¸Šå‚³ç›¸åŒçš„ /predict
	  const res = await fetch("/predict", { method: "POST", body: fd });
	  const html = await res.text();
	  document.open(); document.write(html); document.close();
	};

  </script>
</body>
</html>
